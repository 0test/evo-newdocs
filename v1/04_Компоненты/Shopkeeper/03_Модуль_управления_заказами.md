Управление заказами интернет-магазина
## Функции ##
- Редактирование и удаление поступивших заказов;
- Возможность установить заказу статус (новый, в процессе выполнения, отправлен, выполнен, возникли проблемы);
- Возможность писать заметки к каждому заказу;
- Сортировка заказов.
- Управление товарами в каталоге (создание, редактирование).

## Конфигурация ##
- **Заказов на странице** -  число заказов в списке на одной странице.
- **Валюта** - влияет на отображения в таблице заказов и подробной информации о заказе.
- **Цвета статусов** - цвета строк в таблице заказов, соответствующие статусам заказов. Названия статусов можно менять в языковом файле `shopkeeper/lang/lang_ru.php`
- **Учет товара на складе** - имя TV-параметра, который используется для учета кол-ва товаров на складе. Подробнее ниже.
- **Категория каталога по умолчанию** - Укажите ID документа, который будет использоваться для каталога по умолчанию. В модуле появится кнопка для перехода в каталог. Необходимо также настроить плагин SaveToSHK.
- **Отменять заказ через, дн(я/ей)** - если заказ находится в статусе "Принят к оплате" больше дней, он отменяется.
- **ID TV-параметра цены** - нужно для каталога Shopkeeper.
- **Отправлять покупателю эл. письма при изменении статуса заказа** - письма отправляются при переводе заказа в статусы "Принят к оплате" и "Отправлен". Шаблоны для писем находятсяв папке shopkeeper/module/templates/.
- **Шаблон для контактной информации** - шаблон подробного вида контактной информации заказа. Можно указывать плейсхолдеры только те, которые используются в шаблоне письма заказа сниппета eForm (параметр `&report`), а также `[+orderData+] (состав заказа)` и `[+orderID+] (номер заказа)`.
- **Шаблон для контактной информации в списке товаров** - шаблон для контактной информации, которая отображается в таблице заказов.
Можно указывать плейсхолдеры только те, которые используются в шаблоне письма заказа сниппета eForm (параметр &report), а также [+orderData+] (состав заказа) и [+orderID+] (номер заказа). 
По умолчанию: `[+name+], [+address+], [+email+], [+phone+], [+delivery+], [+payment+]`
- **Кнопка "Удалить все записи"** удаляет таблицы модуля из базы данных (деинсталляция).

## Шаблоны, чанки и плейсхолдеры ##
<table border="1" cellpadding="5">
<tbody><tr>
  <th>Наименование шаблона</th>
  <th>Плейсхолдеры в шаблоне</th>
  <th>Примечание</th>
</tr>
<tr>
  <td>Шаблон для письма покупателю об изменении статуса заказа</td>
  <td rowspan="2">
    <b>[+date+]</b> - дата заказа;<br>
    <b>[+site_name+]</b> - имя сайта;<br>
    <b>[+orderID+]</b> - номер заказа;<br>
    <b>[+status+]</b> - статус заказа;<br>
    <b>[+loop+]</b>/<b>[+end_loop+]</b> - начало и конец строки данных товаров (цикл);<br>
    <b>[+name+]</b> - название товара;<br>
    <b>[+link+]</b> - ссылка на товар;<br>
    <b>[+price+]</b> - цена товара<br>
    <b>[+addit_data+]</b> - список доп. параметров (используется шаблон additData.tpl);<br>
    <b>[+count+]</b> - кол-во единиц товара;<br>
    <b>[+totalPrice+]</b> - общая цена;<br>
    <b>[+currency+]</b> - валюта;<br>
    <b>[+order_changed_txt+]</b> - текст (берется из языкового файла) выводится, если состав заказа был изменен менеджером магазина и один или более товаров можно купить;<br>
    <b>[+order_notpossible_txt+]</b> - текст (берется из языкового файла) выводится, если ни один из выбранных товаров нельзя купить;<br>
    <!--b>&#91;+if_changed+&#93;</b>/<b>&#91;+end_if+&#93;</b> - Текст между этих плейсхолдеров будет отправляться, если состав заказа был изменен менеджером (например удален какой-то товар).<br-->
    <b>[+contact+]</b> - Контактная информация (адрес, способ доставки и т.п.). Шаблон редактируется в конфигурации модуля.
  </td>
  <td><b>shopkeeper/module/templates/mail_changeStatus.tpl</b></td>
</tr>
<tr>
  <td>Шаблон для письма покупателю об отправке заказа</td>
  <td><b>shopkeeper/module/templates/mail_shipped.tpl</b></td>
</tr>
<tr>
  <td>Шаблон для списка доп. параметров товара в письме</td>
  <td>
    <b>[+param+]</b> - имя и цена параметра. Цена указывается в скобках. Если цена = 0, то пишется только название параметра (без скобок).<br>
    <b>[+name+]</b> - имя параметра.<br>
    <b>[+price+]</b> - цена параметра.
  </td>
  <td><b>shopkeeper/module/templates/additData.tpl</b></td>
</tr>
</tbody></table>

## Каталог ##
Есть возможность хранить товары в каталоге Shopkeeper, а не в дереве документов.

Чтобы в модуле Shopkeeper (в админке) появилась ссылка "Каталог", нужно в конфигурации указать ID категории каталога (ID документа) по умолчанию.
Также необходимо настроить конфигурацию плагина SaveToSHK — указать ID шаблона товаров и ID TV-параметра цены.

В каталоге для перехода в другую категорию нужно нажать на иконку рядом с названием текущей категории и выбрать в дереве документов новую. Потом нажать на появившуюся ссылку категории.

Для нормальной работы каталога Shopkeeper нужно настроить плагин SaveToSHK. Укажите ID шаблона товаров и ID TV-параметра цены.

## Учет количества товаров на складе ##
Для того чтобы покупатель и владелец магазина знали какое кол-во товара есть на складе, можно создать дополнительный TV-параметр (например inventory) с типом ввода "Text". Далее в конфигурации модуля нужно ввести имя TV в поле "Учет товара на складе (имя TV)". 

После перевода заказа в статус "Отправлен" число этого параметра для каждого выбранного товара будет автоматически пересчитано. Если поле "Учет товара на складе" пусто, кол-во товаров на складе не учитывается.

## Важно ##
Для того чтобы заказы отправлялись в модуль, в вызов сниппета eForm добавить параметры:
```
&eFormOnBeforeMailSent=`populateOrderData`
&eFormOnMailSent=`sendOrderToManager`
```


В чанке шаблона формы оформления заказа должно быть скрытое поле с названием чанка текста письма (reportTpl) 

```<input type="hidden" name="reportTpl" value="shopOrderReport" />```

### Пример вызова eForm ###

```
[!eForm?
&formid=`shopOrderForm`
&tpl=`shopOrderForm`
&report=`shopOrderReport`
&vericode=`1`
&gotoid=`11`
&subject=`Заказ в интернет-магазине`
&eFormOnBeforeMailSent=`populateOrderData`
&eFormOnMailSent=`sendOrderToManager`
!] 
```

## Экспорт заказов ##
В модуле есть возможность экспортировать список заказов в CSV-файл. 

Если для открытия вы используете OpenOffice, открыв файл, укажите параметр разделителя - "Точка с запятой", кодировка - "Кирилица (Windows-1251)".
