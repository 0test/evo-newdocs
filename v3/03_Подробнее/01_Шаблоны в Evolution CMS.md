# Шаблоны в Evolution CMS #

Стандартный шаблонизатор в Evolution CMS это **Blade** - движок шаблонов, входящий в состав Laravel.

**Где можно взять готовые шаблоны?** 

Evolution CMS позволяет легко использовать **любой** сверстанный HTML-макет.

Работа с шаблонами включает в себя две составные части:

1. [Работа с шаблоном внутри админ-панели](#section1)
    1. [Создание шаблона](#section1-1)
    2. [Шаблон по-умолчанию](#section1-2)
    3. [Как изменить поля при редактировании или создании документа](#section1-3)
    4. [Как назначить ресурсу шаблон](#section1-4)
2. [Шаблонизация и работа с файлами blade](#section2)
    1. [Связь файла blade и шаблона в админ-панели](#section2-2)
    2. [Внутреннее устройство шаблонов blade](#section2-3)
    3. [Наследование шаблонов](#section2-4)
    4. [Директивы и переменные](#section2-5)


## Работа с шаблонами в админ-панели <a name="section1"></a> ##

### Создание шаблона <a name="section1-1"></a> ###
Все шаблоны находятся в следующем месте:
```
Элементы -> Шаблоны
```
Для создания нового шаблона необходимо нажать на ссылку "Новый шаблон".

При создании шаблона можно выбрать, какие ТВ-параметры ему принадлежат.

> Старайтесь называть шаблоны понятными терминами: "Главная", "Текстовые страницы", "Статья" и прочее.

Не забудьте задать псевдоним (`alias`) и  нажать чекбокс "Создать файл шаблона".  Эта опция создаёт файл `/views/alias.blade.php`.

![Создать шаблон](/assets/images/s4.png)

Дальнейшая работа с blade-файлом происходит уже с помощью IDE.

### Шаблон по-умолчанию <a name="section1-2"></a> ###

При создании документа автоматически предлагается шаблон по-умолчанию (если иное поведение не определено плагинами).
Удобнее всего, когда предлагается именно тот шаблон, который необходим чаще всего. Для этого необходимо настроить шаблон по умолчанию:

Переходим в настройки системы управления:
```
Конфигурация -> Сайт
```
Находим параметр **Шаблон по-умолчанию** и меняем на нужный.

### Как скрыть/изменить поля при редактировании или создании документа? <a name="section1-3"></a> ###

Воспользуйтесь TemplatesEdit3.

Это дополнение для изменения внешнего вида  редактирования ресурса. Позволяет перемещать, скрывать и изменять как стандартные поля, так и ТВ-параметры.

### Как назначить ресурсу шаблон? <a name="section1-4"></a> ###

При создании или редактировании ресурса вам будет доступно поле с выбором шаблона.

![Дерево документов](/assets/images/s8.png)



## Работа с файлами Blade <a name="section2"></a> ##

>  Blade прекрасно документирован, большая часть директив из официальной документации Laravel работает и в Evolution CMS.

> Ссылки на сторонние ресурсы:
> * [На английском](https://laravel.com/docs/9.x/blade)
> * [На русском](https://laravel.su/docs/8.x/blade)

#### Местоположение шаблонов ####
Файлы шаблонов используют расширение файла .blade.php и обычно хранятся в каталоге `/views` в корневой директории сайта.

Шаблоны могут быть вложены в подкаталоги каталога `/views`. 

Для указания вложенности используется «точечная нотация». Например, если ваш шаблон хранится в `/views/admin/profile.blade.php`, то вы можете вернуть его из маршрута/контроллера следующим образом:
```
admin.profile
```


### Связь файла blade и шаблона в админ-панели <a name="section2-2"></a> ###

Evolution CMS использует для связи файла шаблона и его названия в админ-панели поле "псевдоним".
  
Если вы создаёте шаблон с псевдонимом `main`, то в папке `/views` необходимо создать файл `main.blade.php`.

> Если при создании шаблона  отметить чекбокс "Создать файл шаблона", шаблон будет создан автоматически.
Либо же шаблон можно создать вручную.


### Внутреннее устройство шаблонов blade <a name="section2-3"></a> ###

Шаблоны Blade содержат HTML-теги и директивы Blade, которые позволяют выводить значения, использовать оператор "if-else", выполнять итерацию данных в цикле и многое другое.

#### Переменные ####
Вы можете отобразить содержимое переменной `name` следующим образом:

```
Hello, {{ $name }}.

```
#### Экранирование ####
Выражения `{{ }}` автоматически обрабатываются функцией htmlspecialchars для предотвращения XSS-атак. Если вы не хотите, чтобы ваши данные были экранированы, вы можете использовать следующий синтаксис:
```
Hello, {!! $name !!}.
```
### Наследование шаблонов <a name="section2-4"></a> ###

Поскольку большинство веб-приложений имеют одинаковый общий макет на разных страницах, удобно определить этот макет как общий шаблон Blade:

```html
<!-- views/layouts/app.blade.php -->
<html>
<head>
    <title>App Name - @yield('title')</title>
</head>
<body>
    @section('sidebar')
        Сайдбар по-умолчанию
    @show
    <div class="container">
        @yield('content')
    </div>
</body>
</html>
```
Как видите, этот файл содержит типичную разметку HTML. Однако, обратите внимание на директивы `@section` и `@yield`. 

Директива `@section`, как следует из названия, определяет секцию содержимого.

Директива `@yield` используется для отображения содержимого, которое будет отдано из дочернего шаблона.

Теперь, когда мы определили макет для нашего приложения, давайте определим дочернюю страницу, которая наследует этот макет.

#### Расширение макета, @extends ####
При определении дочернего шаблона используйте директиву Blade `@extends`, чтобы указать, какой макет дочерний шаблон должен «наследовать».

Шаблоны, расширяющие макет Blade, могут добавлять содержимое в секции макета с помощью директив `@section`. Как видно из приведенного выше примера, содержимое этих секций будет отображаться в макете с помощью `@yield`:

```html
<!-- resources/views/child.blade.php -->

@extends('layouts.app')
@section('title', 'Page Title')

@section('sidebar')
@parent
<p>Это будет добавлено к сайдбару</p>
@endsection

@section('content')
<p>Контент</p>
@endsection
```
В этом примере секция sidebar использует директиву `@parent` для добавления (а не перезаписи) содержимого к сайдбару макета. Директива `@parent` будет заменена содержимым макета при визуализации представления. Вы можете убрать её и полностью заменить секцию на своё содержание.

Директива `@yield`  принимает значение по умолчанию в качестве второго параметра. Это значение будет отображено, если раздел не определен:
```
@yield('content', 'Default')
```

#### @include ####

Если вы хотите всегда включать в шаблон какой-то блок, воспользуйтесь  директивой `@include`.

Допустим, на сайте всегда одинаковый футер. Создайте файл `footer.blade.php` в папке `parts`.

Подключите его:
```html
@include('parts.footer')
```
Если в `@include` нужно обработать данные, воспользуйтесь следующей конструкцией 

```html
@include('patch.to.view',[ 'data' => $data] )
```

### Директивы и переменные <a name="section2-5"></a> ###


#### Переменные Evolution CMS ####

Вы можете отобразить содержимое переменной `name` следующим образом:

```
Hello, {{ $name }}.
```
**Экранирование**

Выражения `{{ }}` автоматически обрабатываются функцией htmlspecialchars для предотвращения XSS-атак. Если вы не хотите, чтобы ваши данные были экранированы, вы можете использовать следующий синтаксис:
```
Hello, {!! $name !!}.
```
#### Вызов методов Evolution CMS ####

Вам доступны системные переменные


```php
$modx
// dd($modx)
```

```php
$documentObject
// dd($documentObject)
```

Таким образом можно получить доступ к различным объектам, предоставляемым системой.
```
{!! $modx->getConfig('site_name) !!}
```
```
{!! $modx->runSnippet('DocLister', [
	'parent' => 1,
])!!}
```

Или получить любое поле ресурса:

```html
{!! $documentObject['content'] !!}
```

#### Директивы  Evolution CMS ####

Существуют специальные директивы, которых нет в Laravel.

`@evoParser` - получает на вход строку, обрабатывает её старым парсером Evolution CMS и отдаёт результат
```
@evoParser('Ссылка на страницу с идентификатором 2: <a href="[~2~]">ссылка</a>')
```

`@makeUrl` - получает на вход идентификатор ресурса и генерирует его адрес.

```html
@makeUrl(2)
```

#### Оператор If #### 
```html
@if (count($records) === 1)
    Один
@elseif (count($records) > 1)
    Много
@else
   Пусто
@endif
```

#### Оператор isset #### 
```html
@isset($records)
    // Переменная $records определена и не равна `null` ...
@endisset

@empty($records)
    // Переменная $records считается «пустой» ...
@endempty
```

####  Операторы Switch #### 
```html
@switch($i)
    @case(1)
        Первое
        @break
    @case(2)
        второе
        @break
    @default
        По-умолчанию
@endswitch
```

####  Циклы #### 
```html
@for ($i = 0; $i < 10; $i++)
    The current value is {{ $i }}
@endfor
```

```html
@foreach ($users as $user)
    <p>This is user {{ $user->id }}</p>
@endforeach
```

```html
@forelse ($users as $user)
    <li>{{ $user->name }}</li>
@empty
    <p>No users</p>
@endforelse
```

```html
@while (true)
    <p>I'm looping forever.</p>
@endwhile
```





