# Клиентские события

Данные события вызываются на клиенте, для вызова и перехвата используется `jQuery`. Все события находятся в пространстве имен `commerce`.

При работе с корзиной (это действия `add`, `remove`, `update`, `clean`) порядок вызова событий следующий:

1. `action-start.commerce`
2. `cart-<action>.commerce` - в этом событии можно отменить дальнейшие действия
3. `cart-<action>-complete.commerce`
4. `action-complete.commerce`

## Описание событий

Содержание:

- [Действие](#params_action)
- [Корзина](#params_cart)
- [Корзины](#params_carts)
- [Заказ](#params_order)

### <a name="params_action"></a> Действие

#### action-start

Вызывается при любом действии с корзиной, в самом начале обработки.

Параметры события:

| Параметр | Описание                               |
| -------- | -------------------------------------- |
| `action` | Название действия, например `cart/add` |
| `params` | Данные действия.                       |

Параметр `params`:

- при добавлении в корзину содержат данные товара, тип корзины
- при удалении из корзины содержат идентификатор строки
- и т.д.

```js
$(document).on("action-start.commerce", function (e, params) {
  console.log(params.action + " called with ", params.data);
});
```

#### action-complete

Вызывается после того, как действие с корзиной произведено.

Параметры события:

| Параметр   | Описание                               |
| ---------- | -------------------------------------- |
| `action`   | Название действия, например `cart/add` |
| `params`   | Данные действия.                       |
| `response` | Ответ сервера                          |

Параметр `params`:

- при добавлении в корзину содержат данные товара, тип корзины
- при удалении из корзины содержат идентификатор строки
- и т.д.

### <a name="params_cart"></a> Корзина

#### cart-add

Вызывается перед добавлением товара в корзину. Позволяет отменить добавление

Параметры события:

| Параметр | Описание                                                                          |
| -------- | --------------------------------------------------------------------------------- |
| `params` | Параметры запроса. В зависимости от способа вызова может содержать разные данные. |

Например, в параметре `params` при добавлении товара из формы здесь будут все данные из полей этой формы, а если товар добавляется простой ссылкой с атрибутом `data-commerce-action="add"`, в параметрах будут все data-параметры этой ссылки. Обязательно присутствует только `id`.

Стандартные параметры запроса:

| Параметр | Описание                                                                 | Умолч.     |
| -------- | ------------------------------------------------------------------------ | ---------- |
| `id`     | Идентификатор добавляемого товара                                        |            |
| `count`  | Количество. Если отсутствует, считается равным 1                         | `1`        |
| `cart`   | Объект для описания корзины. Содержит значение `instance` - тип корзины. | `products` |

Пример:

```js
$(document).on("cart-add.commerce", function (e, params) {
  if (params.cart.instance == "comparison" && params.id == 53) {
    e.preventDefault();
  }
});
```

#### cart-add-complete

Вызывается при обработке ответа сервера на запрос добавления товара

Параметры события:

| Параметр   | Описание                                                     |
| ---------- | ------------------------------------------------------------ |
| `response` | Ответ сервера.                                               |
| `data`     | Параметры запроса, тот же состав, как и в событии `cart-add` |

Параметр `response` содержит:

- `status` - результат запроса `success` / `failed`
- `row` - уникальный идентификатор строки с добавленным товаром в корзине

```js
$(document).on("cart-add-complete.commerce", function (e, params) {
  if (params.response.status == "success") {
    $('.product[data-id="' + params.data.id + '"]').addClass("in-cart");
  }
});
```

#### cart-remove

Вызывается перед удалением товара из корзины.

#### cart-remove-complete

Вызывается при обработке ответа сервера на запрос удаления товара из корзины.

#### cart-update

Вызывается перед изменением товара.

#### cart-update-complete

Вызывается при обработке ответа сервера на запрос изменения товара.

#### cart-clean

Вызывается перед очисткой корзины.

#### cart-clean-complete

Вызывается при обработке ответа сервера на запрос очистки корзины.

```js
$(document).on("cart-clean-complete.commerce", function (e) {
  $(".order").remove();
});
```

#### collect-hashes

Вызывается при каждом запросе к серверу для сбора хэшей всех корзин на странице, с целью обновления содержимого этих корзин.

#### cart-reload

Вызывается перед обновлением содержимого корзины, действие можно отменить.

```js
$(document).on("cart-reload.commerce", function (e) {
  if ($(e.target).hasClass("sidecart")) {
    e.preventDefault();
  }
});
```

#### cart-reloaded

Вызывается после обновления содержимого корзины.

```js
$(document).on("cart-reloaded.commerce", function (e) {
  var $cart = $(e.target);

  if ($cart.hasClass("minicart")) {
    $cart.addClass("animate");
  }
});
```

### <a name="params_carts"></a> Корзины

#### carts-reloaded

Вызывается после обновления всех корзин, но только при прямом вызове метода `Commerce.reloadCarts()`.

```js
$(document).on("carts-reloaded.commerce", function (e) {
  alert("Все корзины обновлены!");
});
```

### <a name="params_order"></a> Заказ

#### order-data-update

Вызывается перед отправкой на сервер данных формы заказа.

#### order-data-updated

Вызывается после отправки на сервер данных формы заказа.
