# Корзина заказов

Корзина вызывается на всех страницах, где необходима работа магазина -- добавление, редактирование и удаление товаров.

> Совет: корзина - это обёртка для сниппета `DocLister` и в ней работают практически все его параметры.

Содержание:

- [Как это может пригодиться?](#usefullness)
- [Пример вызова](#example)
- [Параметры](#params)
- [Шаблоны](#tpls)

## <a name="usefullness"></a> Как это может пригодиться?

Скажем, вы хотите показывать в корзине фотографию товара. Пускай она хранится в ТВ с именем `mainphoto`. Как и в `DocLister`, вам необходимо при помощи параметра `&tvList='mainphoto'` указать сниппету, что в выборку включается ТВ.

## <a name="example"></a> Пример вызова

```
[!Cart
    &instance=`products`
    &tvList=`image`
!]
```

## <a name="params"></a> Параметры

| параметр                                            | описание                      | умолч.     |
| --------------------------------------------------- | ----------------------------- | ---------- |
| [instance](#param_instance)                         | тип корзины                   | `products` |
| [theme](#param_theme)                               | префикс имени шаблонов        |            |
| [tpl](#param_tpl)                                   | шаблон строки корзины         |
| [ownerTPL](#param_ownertpl)                         | шаблон обёртки корзины        |            |
| [noneTPL](#param_nonetpl)                           | шаблон пустой корзины         |            |
| [optionsTpl](#param_optionstpl)                     | шаблон строки опций товара    |            |
| [defaultOptionsRender](#param_defaultoptionsrender) | рендер опций товара           | `1`        |
| [subtotalsTpl](#param_subtotalstpl)                 | обёртка доп. сборов           |            |
| [subtotalsRowTpl](#param_subtotalsrowtpl)           | строка доп. сборов            |            |
| [prepareSubtotalsWrap](#param_preparesubtotalswrap) | `prepare` обёртки доп. сборов |            |
| [prepareSubtotalsRow](#param_preparesubtotalsrow)   | `prepare` строк доп.сборов    |            |
| [другое](#param_other)                              |                               |            |

### <a name="param_instance"></a> instance

Тип корзины.

С помощью сниппета можно вывести корзину с товарами, либо списки избранного или сравнения. Соответственно, значение может быть `products`, `wishlist` или `comparison`.

_По умолчанию:_ `products`

Данные значения предустановлены. Если нужны другие списки, их можно создать в плагине на событие `OnInitializeCommerce`:

```php
ci()->carts->addCart(new \Commerce\Carts\ProductsList($modx, 'listname'));
```

### <a name="param_theme"></a> theme

Префикс имени шаблонов.

Можно использовать для темизации корзины, чтобы не указывать все шаблоны по отдельности. Может быть либо префиксом имен файлов, либо именем вложенной папки (тогда в конце нужно указать слэш).

Изначально доступны шаблоны без префикса и с префиксом `mini`, например `minicart_wrap` и пр. - для миникорзины.

_По умолчанию:_ нет значения

### <a name="param_tpl"></a> tpl

Шаблон строки корзины, соответствует такому же параметру `DocLister`.

Помимо стандартных, в шаблоне доступны следующие плейсхолдеры:

| плейсхолдер          | описание                                                                         |
| -------------------- | -------------------------------------------------------------------------------- |
| `[+original_title+]` | название товара из таблицы `site_content`                                        |
| `[+hash+]`           | хэш-код строки                                                                   |
| `[+count+]`          | количество данного товара                                                        |
| `[+price+]`          | цена товара                                                                      |
| `[+total+]`          | полная стоимость данного товара                                                  |
| `[+options+]`        | опции товара (обработанные или нет, зависит от параметра `defaultOptionsRender`) |

### <a name="param_ownertpl"></a> ownerTPL

Шаблон обертки корзины, соответствует такому же параметру `DocLister`.

Помимо стандартных, в шаблоне доступны следующие плейсхолдеры:

| плейсхолдер       | описание                                                 |
| ----------------- | -------------------------------------------------------- |
| `[+hash+]`        | хэш-код козины                                           |
| `[+items_price+]` | суммарная стоимость товаров                              |
| `[+total+]`       | полная стоимость корзины, с учетом дополнительных сборов |
| `[+subtotals+]`   | дополнительные сборы                                     |
| `[+count+]`       | число товаров в корзине                                  |
| `[+rows_count+]`  | число строк в корзине                                    |
| `[+settings+]`    | массив настроек плагина `Commerce`                       |

### <a name="param_nonetpl"></a> noneTPL

Шаблон пустой корзины.

### <a name="param_optionstpl"></a> optionsTpl

Шаблон строки опций товара. Имеет смысл только при `&defaultOptionsRender='1'`.

Подразумевается, что опции товара заданы как массив пар ключ => значение.

В шаблоне доступны следующие значения:

| плейсхолдер  | описание       |
| ------------ | -------------- |
| `[+key+]`    | ключ           |
| `[+option+]` | значение опции |

### <a name="param_defaultoptionsrender"></a> defaultOptionsRender

Нужно ли рендерить опции товара.

Если структура опций имеет более сложный формат, можно поставить значение `0`, а опции нужно обрабатывать в `prepare`.

_Значения:_ `0`, `1`

_По умолчанию:_ `1`

### <a name="param_subtotalstpl"></a> subtotalsTpl

Шаблон обертки для дополнительных сборов.

### <a name="param_subtotalsrowtpl"></a> subtotalsRowTpl

Шаблон строки дополнительных сборов.

Доступные следующие плейсхолдеры:

| плейсхолдер | описание |
| ----------- | -------- |
| `[+title+]` | название |
| `[+price+]` | цена     |

### <a name="param_preparesubtotalswrap"></a> prepareSubtotalsWrap

`prepare` для обертки дополнительных сборов, действие аналогично параметру `prepareWrap`

### <a name="param_preparesubtotalsrow"></a> prepareSubtotalsRow

`prepare` для строк дополнительных сборов, действие аналогично параметру prepare

### <a name="param_other"></a> Другое

Остальные параметры абсолютно аналогичны таковым в сниппете `DocLister`.

## <a name="tpls"></a> Шаблоны

Все шаблоны по умолчанию лежат в папке `assets/plugins/commerce/templates/front/`.

Чтобы изменить вид корзины, можно указать свои чанки с помощью параметров сниппета, либо скопировать все чанки корзины в новую папку и указать имя папки в параметре `theme`.

Не изменяйте чанки по умолчанию напрямую - так при обновлении вы потеряете все изменения.

### Схема шаблона корзины

В разметке корзины должны быть обязательные атрибуты, необходимые для корректной работы скриптов.

```
<... data-commerce-cart="[+hash+]">
    <... data-id="[+id+]" data-commerce-row="[+row+]" ...>
        <input type="text" name="count" value="[+count+]" data-commerce-action="recount">
        <... data-commerce-action="decrease" .../>
        <... data-commerce-action="increase" .../>
        <... data-commerce-action="remove" .../>
    </...>

    <... data-commerce-action="clean" .../>
</...>
```

| атрибут                           | описание                                                                                  |
| --------------------------------- | ----------------------------------------------------------------------------------------- |
| `data-commerce-cart="[+hash+]"`   | Атрибут обертки корзины, все содержимое данного тега обновляется при изменениях в корзине |
| `data-commerce-row="[+row+]"`     | Хеш-код строки корзины, используется для обновления данных в этой строке                  |
| `data-id="[+id+]"`                | Идентификатор товара, присваивается строке корзины                                        |
| `data-commerce-action="recount"`  | Поле с количеством товара                                                                 |
| `data-commerce-action="decrease"` | Элемент, по нажатию на который происходит уменьшение товара в строке на 1                 |
| `data-commerce-action="increase"` | Элемент, по нажатию на который происходит увеличение товара в строке на 1                 |
| `data-commerce-action="remove"`   | Элемент, по нажатию на который происходит удаление строки из корзины                      |
| `data-commerce-action="clean"`    | Элемент, по нажатию на который происходит очистка корзины                                 |
