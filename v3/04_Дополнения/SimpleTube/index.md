# SimpleTube

**Важно!** Для работы необходимо наличие `DocLister`.

Автор: [Pathologic](https://github.com/Pathologic/)

Скачать можно здесь: [SimpleTube](https://github.com/Pathologic/SimpleTube).

SimpleTube - плагин и сниппет для создания видеогалерей.

Основных отличий всего два, но мне кажется, они достаточно существенные, чтобы сменить название:

- теперь используется отдельная таблица для хранения данных, вместо TV-параметра с json;
- новый удобный интерфейс c jQuery EasyUI

Сниппет умеет находить с помощью класса [Panorama-PHP](http://frandieguez.github.io/panorama-php/) информацию о видео по ссылке, а также при возможности скачивать картинку-превью. Поддерживаются youtube, rutube, vimeo, metacafe и dailymotion. Вообще класс поддерживает больше видеохостингов, но это в теории; поэтому я оставил только то, что более-менее работает (при этом, например, о metacafe и dailymotion я ни разу не слышал).

С помощью этого сниппета плагин получает информацию для добавления в таблицу, но ничто не мешает использовать его без плагина, как сниппет `getVideo` из `MultiVideos`.

## Параметры снипепта

| параметр        | описание                                                                                      | умолч.                                   |
| --------------- | --------------------------------------------------------------------------------------------- | ---------------------------------------- |
| `input`         | ссылка                                                                                        |                                          |
| `forceDownload` | если 1, то всегда скачивать превью, если 0, то только в том случае, если картинки нет в папке | `0`                                      |
| `folder`        | папка для хранения превью                                                                     | `assets/images/video/`                   |
| `noImage`       | путь к картинке, которая выводится в режиме `&api='0'` при отсутствии превью                  | `assets/snippets/simpletube/noimage.png` |
| `api`           | если 0, то выводится чанк &tpl, 1 – json, 2 – массив                                          | `0`                                      |
| `tpl`           | чанк для вывода в режиме `&api='0'`, указывается так же, как в DocLister                      |                                          |
| `ytApiKey`      | ключ для работы с Youtube                                                                     |                                          |

В параметрое `&tpl` доступны плейсхолдеры:

| плейсхолдер       | описание                              |
| ----------------- | ------------------------------------- |
| `[+st_title+]`    | название видео                        |
| `[+st_thumbUrl+]` | ссылка на превью или картинку noImage |
| `[+st_embedUrl+]` | ссылка для встраивания                |
| `[+st_service+]`  | название видеохостинга                |
| `[+st_duration+]` | длина видео, секунд                   |

Если параметр `&ytApiKey` не указан, то сниппет попытается получить это значение из настроек плагина.

## Параметры плагина

Плагин используется для управления галереями на странице ресурса.

| параметр              | описание                                      |
| --------------------- | --------------------------------------------- |
| `Tab name`            | название вкладки                              |
| `Templates`           | id шаблонов ресурсов с видео, **обязательно** |
| `Roles`               | id разрешенных ролей                          |
| `Thumbs folder`       | папка для превью                              |
| `Thumbs cache folder` | папка для превью превью (:                    |
| `No image picture`    | картинка, если нет превью                     |
| `Thumbs width`        | ее ширина                                     |
| `Thumbs height`       | и высота                                      |
| `Force download`      | скачивать превью всегда или при необходимости |
| `Youtube API Key`     | ключ для работы с YouTube                     |

Вывод такой же, как в `SimpleGallery` – c поправкой на название таблицы и полей. Поэтому смотреть в [примерах SimpleGallery](../SimpleGallery/05_Примеры.md).

## Поля в таблице st_videos

| поле           | описание                                             |
| -------------- | ---------------------------------------------------- |
| `st_id`        | id видео (idField)                                   |
| `st_index`     | позиция в списке                                     |
| `st_title`     | название видео                                       |
| `st_videoUrl`  | исходная ссылка на видео                             |
| `st_thumbUrl`  | ссылка на превью                                     |
| `st_embedUrl`  | ссылка для встраивания                               |
| `st_duration`  | длина видео, секунды                                 |
| `st_isactive`  | флажок, чтобы скрыть какие-то видео из вывода        |
| `st_service`   | название видеохостинга                               |
| `st_rid`       | id ресурса, которому принадлежит видео (parentField) |
| `st_createdon` | дата добавления видео                                |

## Получение ключа для Youtube

Старый API, с которым можно было работать без ключей, больше не доступен, поэтому придется регистрировать аккаунт и получать ключ:

- Идем сюда <a href="https://console.developers.google.com/" rel="nofollow" target="_blank">console.developers.google.com/</a>
- Создаем проект
- В разделе APIs выбираем YouTube Data API, нажимаем Enable API
- В разделе Credentials нажимаем Create New Key, выбираем Browser Key и сразу Create (в текстовое поле ничего писать не нужно)
- Копируем API Key и вставляем в настройки плагина
