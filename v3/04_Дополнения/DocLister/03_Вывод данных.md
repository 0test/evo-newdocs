# Вывод данных

- [Задание шаблонов](#tpls)
- [Плейсхолдеры](#plhld)
- [Параметры для установки плейсхолдеров](#plhldparams)
- [Параметры вывода в шаблоны](#tplparams)
- [Разбивка по страницам](#paginate)
- [Вывод в плейсхолдеры](#plhldres)
- [Разделитель между шаблонами](#tplsep)
- [API-режим](#apimode)

## <a name="tpls"></a> Задание шаблонов

По умолчанию считается, что в параметрах шаблона передано имя чанка. Но если имя чанка начинается с символа `@`, то происходит сверка начального слова в имени шаблона с заранее зарезервироваными правилами загрузки шаблонов. Все последующие слова используется в качестве параметра к выбранному правилу.

- `@FILE` загрузка шаблона из html файла расположенного в папке или подпапках assets/templates/
- `@CHUNK` обычная загрузка шаблона из чанка
- `@TPL`, `@CODE` значение параметра используется в роли inline шаблона
- `@DOCUMENT`, `@DOC` шаблон берется из content поля указанного документа
- `@PLH`, `@PLACEHOLDER` шаблон загружается из глобального плейсхолдера Evolution CMS
- `@CFG`, `@CONFIG`, `@OPTIONS` шаблон берется из глобальных настроек текущей установки Evolution CMS

Стоит заметить, что даже если начальный символ был `@` и после обработки всех правил шаблон все равно оказался пустым, то происходит попытка обнаружить чанк по полному имени шаблона

## <a name="plhld"></a> Плейсхолдеры

Плейсхолдеры в DocLister:

- **плейсхолдер таблицы** - имя такого плейсхолдера совпадает с названием колонки в таблице;
- **виртуальный плейсхолдер** - доступен после запуска экстендера или каких-то вычислений внутри контроллера;
- **глобальный плейсхолдер** - доступен из вне шаблонов передаваемых в сниппет (как правило имеет префикс dl и может быть переопределен при помощи параметров sysKey или id).

> Экстендер в DocLister - это вспомогательный класс для каких-либо обработок, не имеет ничего общего с экстендерами Ditto.

### Плейсхолдеры таблицы

Если указан контроллер `site_content` или любой другой его расширяющий, то по умолчанию используется таблица `site_content`.

В случае с контроллером `onetable` имя таблицы определяется параметром `table`. Таким образом, получить полный список плейсхолдеров можно открыв таблицу `mysql`, например, через `phpmyadmin` и подсмотрев какие в этой таблице имеются поля.

### Виртуальный плейсхолдер

#### экстендер paginate

Для вывода списка номеров страниц и действий с ним.

- `параметр_id.pages` - постраничная разбивка (пагинация)
- `параметр_id.totalPages` - общее число страниц
- `параметр_id.isstop` - значение `1` если текущая страница — последная
- `параметр_idisstart` - значение `1` если текущая страница — первая
- `параметр_id.from` - номер документа на странице "от", _пример:_ товаров **1**-8 из 16
- `параметр_id.to` - номер документа на странице "до", _пример:_ товаров 1-**8** из 16
- `параметр_id.count` - общее количество документов, _пример:_ товаров 1-8 из **16**

#### экстендер jotcount

Экстендер загружается, если при вызове сниппета задан параметр `&jotcount`.

- `jotcount` - число комментариев из сниппета JOT

#### экстендер tv

- `tv.имяТВпараметра+` - значение ТВ параметра

_По умолчанию:_ ко всем ТВ параметрам добавляется префикс `tv`, но от него можно избавиться или переопределить параметром `tvPrefix`.

#### экстендер e

Экстендер загружается, если при вызове сниппета задан параметр `&е='имена полей через запятую'`

- `e.имяПоля` - экранированное значение поля с именем `имяПоля`, _пример:_ `e.pagetitle`

#### экстендер summary

- `summary` - аннотация к странице

#### экстендер user

Экстендер необходимо загрузить вручную, указав его имя в параметре `&extender`.

Также должны быть заданы параметры:

- `usertype` - возможные значения: `manager`, `mgr`, `web`. Определяет из каких таблиц брать данные пользователей;
- `userFields` - названия колонок через запятую, в которых указан `id` пользователя, например `createdby`, `publishedby`.

Плейсхолдеры:

- `user.id.НазваниеКолонки` - ID пользователя
- `user.username.НазваниеКолонки` - логин пользователя
- `user.fullname.НазваниеКолонки` - полное имя пользователя
- `user.role.НазваниеКолонки` - ID роли пользователя
- `user.email.НазваниеКолонки` - e-mail
- `user.phone.НазваниеКолонки` - телефон
- `user.mobilephone.НазваниеКолонки` - мобильный телефон
- `user.blocked.НазваниеКолонки` - статус блокировки
- `user.blockeduntil.НазваниеКолонки` - до какого UNIX-времени пользователь будет заблокирован
- `user.blockedafter.НазваниеКолонки` - после какого UNIX-времени пользователь будет заблокирован
- `user.logincount.НазваниеКолонки` - общее число авторизаций
- `user.lastlogin.НазваниеКолонки` - UNIX-время последней авторизации
- `user.thislogin.НазваниеКолонки` - UNIX-время текущей авторизации
- `user.failedlogincount.НазваниеКолонки` - число неудачных попыток авторизоваться
- `user.lastlogin.НазваниеКолонки` - UNIX-время последней авторизации
- `user.dob.НазваниеКолонки` - дата рождения
- `user.gender.НазваниеКолонки` - пол
- `user.country.НазваниеКолонки` - страна
- `user.state.НазваниеКолонки` - регион
- `user.zip.НазваниеКолонки` - почтовый индекс
- `user.fax.НазваниеКолонки` - факс
- `user.photo.НазваниеКолонки` - фотография
- `user.comment.НазваниеКолонки` - коммментарий

#### контроллер site_content

- `title` - название документа для списков из `menutitle`, если `menutitle` пуст, то используется `pagetitle`.
- `iteration`, `ЗначениеПараметраsysKey.full_iteration` - порядковый номер элемента в списке; порядковый номер в списке с учетом пагинации.

_Примечание:_ для контроллера `site_content` и для контроллера `shopkeeper` плейсхолдер `iteration` выглядит как указано выше - `iteration` без префикса, а для контроллера `onetable` - как `ЗначениеПараметраsysKey.iteration` с префиксом. Префикс `ЗначениеПараметраsysKey` по умолчанию равен `dl`, то есть для `onetable` этот плейсхолдер по умолчанию - `[+dl.iteration+]`.

- `url` - ссылка на документ
- `date` - дата публикации документа сформированая по правилам указаным в параметре dateFormat (по умолчанию %d.%b.%y %H:%M). Помимо этого учитывается server_offset_time в настройках движка.
- `ЗначениеПараметраsysKey.active` - флаг определяющий, что обрабатываемый документ совпадает и документ на котором был вызван сниппет это одно и тоже (1 - если правда, 0 если нет)
- `ЗначениеПараметраsysKey.class` - классы которые могут быть автоматически присвоены документу (first, last, current, odd, even)
- `ЗначениеПараметраsysKey.wrap` - HTML код списка подготовленный для вывода пользователю (используется только для шаблона ownerTPL)

## <a name="plhldparams"></a> Параметры для установки плейсхолдеров

### sysKey

Префикс для системных плейсхолдеров.

_Значения:_ любая строка. На выходе получается плейсхолдер с именем `sysKey.placeholder`, где `sysKey` это значение данного параметра.

_По умолчанию:_ `dl`

### id

Префикс для локальных плейсхолдеров.

_Значения:_ любая строка. Если `id` указано, то на выходе получается `id.placeholder`. Где `id` это и есть переданое значение. В случае если `id` не задано, то перед именем плейсхолдера точка не ставится.

_По умолчанию:_ пусто.

## <a name="tplparams"></a> Параметры вывода в шаблоны

### ownerTPL

Шаблон в который оборачивается список результатов. Если подходящих результатов не обнаружено, то по умолчанию результат с шаблоном `noneTPL` тоже оборачивается в этот шаблон. За подробностями обращайтесь к описанию параметра `noneWrapOuter`.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ пусто.

_Пример:_ `&ownerTPL='@CODE:<ul class="pages-list">[+dl.wrap+]</ul>'`

### tpl

Шаблон.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в `DocLister`. Значение параметра может быть изменено из prepare-сниппета c помощью свойства `$_DocLister->renderTPL`.

_По умолчанию:_ определяется в контроллере.

_Пример:_ `&tpl='@CODE:<li><img src="[+tv.image+]" alt="[+e.pagetitle+]"><a href="[+url+]">[+title+] ([+id+])</a></li>'`

### tplId1, tplId2, ..., tplIdN

Шаблон для оформления документа под номером 1, 2 и т.д., где номер - это номер итерации начиная с 1.

_По умолчанию:_ берется из значения параметра `tpl`.

_Примечание:_ Обратите внимание, `Id` в названиях шаблонов не должно вводить вас в заблуждение, на самом деле номер - это не `Id` документа, а его номер по порядку в выводе (номер итерации).

### tplOdd, tplEven

Шаблон для оформления четного/нечетного документа.

_По умолчанию:_ берется из значения параметра `tpl`.

### tplFirst

Шаблон для оформления первого документа в списке. Синоним параметра `tplId1`, но имеет больший приоритет.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в `DocLister`. Если не задано, то совпадает с шаблоном tpl.

_По умолчанию:_ пусто.

### tplLast

Шаблон для оформления последнего документа в списке.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в `DocLister`. Если не задано, то совпадает с шаблоном `tpl`.

_По умолчанию:_ пусто.

### tplСurrent

Шаблон для оформления текущего документа в списке документов.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в `DocLister`. Если не задано, то совпадает с шаблоном tpl.

_По умолчанию:_ пусто.

### noneTPL

Шаблон с уведомлением о том, что по заданным критериям ничего не обнаружено.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в `DocLister`.

_По умолчанию:_ пусто.

### noneWrapOuter

Оборачивать ли ответ `noneTPL` в шаблон `ownerTPL`. Параметр актуален только в том случае, если нет документов для построения списка и задан `ownerTPL`.

_Значения:_ `1` или `0`.

_По умолчанию:_ `1`.

## <a name="paginate"></a> Разбивка по страницам (пагинация)

### paginate

Вывод данных с пагинацией. Смотрите плейсхолдеры устанавливаемые экстендером `paginate`.

_Значения:_

- `offset` - пагинация в стиле Ditto;
- `pages` - пагинация с прострелами.

_По умолчанию:_ `pages`.

### TplFirstP

Шаблон для вставки ссылки "первая страница".

_Значения:_ имя шаблона указанное по правилам задания шаблонов в `DocLister`.

_По умолчанию:_ пусто.

### TplLastP

Шаблон для вставки ссылки "последняя страница".

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ пусто.

### TplNextP

Шаблон для вставки ссылки "следующая страница".

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:<a href="[+link+]">' . $this->DocLister->getMsg('paginate.next', 'Next') . ' ></a>`

Плейсхолдеров для подстановки данных из языкового пакета пока нет.

### TplPrevP

Шаблон для вставки ссылки "предыдущая страница".

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:<a href="[+link+]">< ' . $this->DocLister->getMsg('paginate.prev', 'Prev') . '</a>`

Плейсхолдеров для подстановки данных из языкового пакета пока нет.

### TplPage

Шаблон для вставки номера страницы в пагинатор.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:<a href="[+link+]" class="page">[+num+]</a>`

### TplCurrentPage

Шаблон оформления текущей страницы в пагинаторе

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE: <b class="current">[+num+]</b>`

### TplWrapPaginate

Шаблон контейнер для обертки страниц пагинации.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE: <div class="[+class+]">[+wrap+]</div>`

### pageLimit

Число страниц отображаемое в пагинаторе.

_Значения:_ целое число больше ноля.

_По умолчанию:_ `1`.

### pageAdjacents

Максимальное число страниц слева и справа относительно текущей страницы.

_Значения:_ целое число больше ноля.

_По умолчанию:_ `4`.

### PaginateClass

Класс для контейнера в который будут вложены страницы пагинации.

_Значения:_ любая строка сформированная по правилам для подстановки в HTML аттрибут тегов class.

_По умолчанию:_ `paginate`.

### PrevNextAlwaysShow

Всегда показывать "следующая страница" и "предыдущая страница".

_Значения:_ `1` или `0`.

_По умолчанию:_ `0`.

### TplFirstI

Шаблон для вставки ссылки "первая страница", используется совместно с `PrevNextAlwaysShow`.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ пусто.

### TplLastI

Шаблон для вставки ссылки "последняя страница", используется совместно с `PrevNextAlwaysShow`.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ пусто.

### TplNextI

Шаблон для вставки неактивной ссылки "следующая страница", используется совместно с `PrevNextAlwaysShow`.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:[%paginate.next%] >`

### TplPrevI

Шаблон для вставки неактивной ссылки "предыдущая страница", используется совместно с `PrevNextAlwaysShow`.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:< [%paginate.prev%]`

### TplDotsPage

Шаблон прострела.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:...`

### noRedirect

Запрещает переадресацию при запросе несуществующей страницы.

_Значения:_ `0` или `1`.

_По умолчанию:_ `0`.

### paginationMeta

Вывод метатегов prev и next в head сайта.

_Пример:_ `<link rel="prev" href="[+prev+]"><link rel="next" href="[+next+]'">`

_Значения:_ `0` или `1`.

_По умолчанию:_ `0`.

## <a name="plhldres"></a> Вывод в плейсхолдеры

### contentPlaceholder

Установка значений документов в персонализованные плейсхолдеры.

_Значения:_ `0` или `1`.

Если значение параметра равно `1`, то `DocLister` создает плейсхолдеры вида `id.item[x]`, где `x` это порядковый номер документа в списке, а `id` это значение параметра `id` (см. описание параметра `id`).

_По умолчанию:_ `0`

### paginationMetaPlaceholder

_Значения:_ `0` или `1`. Если значение параметра равно `1`, то результат выполнения параметра `paginationMeta` попадает не в шапку, а в глобальный плейсхолдер `paginationMeta`.

_По умолчанию:_ `0`

## <a name="tplsep"></a> Разделитель между шаблонами

### outputSeparator

Установка разделителя, который будет выводиться между значениями, выводимыми в шаблоне `tpl`.

_Значения:_ любая строка.

_По умолчанию:_ пусто.

_Пример:_ Используется в поле "Возможные значения" TV-параметра

```
@EVAL $snippet_name = 'DocLister';
$arrparams = array('id' => 'brands_select','parents' => '1171','depth' => '0','tvPrefix' => '','tvList' => '','tpl'=>'brands_select_tpl','orderBy'=>'pagetitle ASC', 'total' => 'all', 'noneWrapOuter' => '0', 'dateFormat'=>'%d.%m.%Y','outputSeparator'=>'||');
return $modx->runSnippet($snippet_name,$arrparams);
```

## <a name="apimode"></a> API-режим

### api

Используется для формирования выдачи в формате JSON.

_Значения:_ `0`, `1` или список полей выбираемых документов.

_По умолчанию:_ `0`.

### JSONformat

По какому принципу формировать JSON-ответ.

_Значения:_ `old` или `new`.

В формате `old` ответ выглядит в виде обычного массива. В формате `new` ответ заворачивается в `rows` секцию + добавляется примесь `total` в которой указано общее число учавствующих в выборке.

_По умолчанию:_ `old`.
