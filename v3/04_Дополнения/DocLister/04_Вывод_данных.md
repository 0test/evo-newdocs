# Вывод данных

- [Задание шаблонов](#tpls)
- [Плейсхолдеры](#plhld)
- [Параметры для установки плейсхолдеров](#plhldparams)
- [Параметры вывода в шаблоны](#tplparams)
- [Разбивка по страницам](#paginate)
- [Вывод в плейсхолдеры](#plhldres)
- [Разделитель между шаблонами](#tplsep)
- [API-режим](#apimode)

## <a name="tpls"></a> Задание шаблонов

По умолчанию считается, что в параметрах шаблона передано имя чанка. Но если имя чанка начинается с символа `@`, то происходит сверка начального слова в имени шаблона с заранее зарезервироваными правилами загрузки шаблонов. Все последующие слова используется в качестве параметра к выбранному правилу.

- `@FILE` загрузка шаблона из html файла расположенного в папке или подпапках assets/templates/
- `@CHUNK` обычная загрузка шаблона из чанка
- `@TPL`, `@CODE` значение параметра используется в роли inline шаблона
- `@DOCUMENT`, `@DOC` шаблон берется из content поля указанного документа
- `@PLH`, `@PLACEHOLDER` шаблон загружается из глобального плейсхолдера Evolution CMS
- `@CFG`, `@CONFIG`, `@OPTIONS` шаблон берется из глобальных настроек текущей установки Evolution CMS

Стоит заметить, что даже если начальный символ был `@` и после обработки всех правил шаблон все равно оказался пустым, то происходит попытка обнаружить чанк по полному имени шаблона

## <a name="plhld"></a> Плейсхолдеры

| плейсхолдер                   | описание                                                                                                                                            |
| ----------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| [таблицы](#plhld_table)       | имя такого плейсхолдера совпадает с названием колонки в таблице                                                                                     |
| [виртуальный](#plhld_virtual) | доступен после запуска экстендера или каких-то вычислений внутри контроллера                                                                        |
| [глобальный](#plhld_global)   | доступен из вне шаблонов передаваемых в сниппет (как правило имеет префикс `dl` и может быть переопределен при помощи параметров `sysKey` или `id`) |

### <a name="plhld_table"></a> Плейсхолдеры таблицы

Если указан контроллер `site_content` или любой другой его расширяющий, то по умолчанию используется таблица `site_content`.

В случае с контроллером `onetable` имя таблицы определяется параметром `table`. Таким образом, получить полный список плейсхолдеров можно открыв таблицу `mysql`, например, через `phpmyadmin` и подсмотрев какие в этой таблице имеются поля.

### <a name="plhld_virtual"></a> Виртуальный плейсхолдер

> Экстендер в DocLister - это вспомогательный класс для каких-либо обработок, не имеет ничего общего с экстендерами Ditto.

| экстендер                 | описание                     |
| ------------------------- | ---------------------------- |
| [paginate](#ext_paginate) | Вывод списка номеров страниц |
| [jotcount](#ext_jotcount) | Работа с `Jot`               |
| [tv](#ext_tv)             | Работа с tv                  |
| [e](#ext_e)               | Экранирование                |
| [summary](#ext_summary)   | Короткое описание            |
| [user](#ext_user)         | Данные пользователя          |

#### <a name="ext_paginate"></a> экстендер paginate

Для вывода списка номеров страниц и действий с ним.

- `параметр_id.pages` - постраничная разбивка (пагинация)
- `параметр_id.totalPages` - общее число страниц
- `параметр_id.isstop` - значение `1` если текущая страница — последная
- `параметр_idisstart` - значение `1` если текущая страница — первая
- `параметр_id.from` - номер документа на странице "от", _пример:_ товаров **1**-8 из 16
- `параметр_id.to` - номер документа на странице "до", _пример:_ товаров 1-**8** из 16
- `параметр_id.count` - общее количество документов, _пример:_ товаров 1-8 из **16**

#### <a name="ext_jotcount"></a> экстендер jotcount

Экстендер загружается, если при вызове сниппета задан параметр `&jotcount`.

- `jotcount` - число комментариев из сниппета JOT

#### <a name="ext_tv"></a> экстендер tv

- `tv.имяТВпараметра+` - значение ТВ параметра

_По умолчанию:_ ко всем ТВ параметрам добавляется префикс `tv`, но от него можно избавиться или переопределить параметром `tvPrefix`.

#### <a name="ext_e"></a> экстендер e

Экстендер загружается, если при вызове сниппета задан параметр `&е='имена полей через запятую'`

- `e.имяПоля` - экранированное значение поля с именем `имяПоля`, _пример:_ `e.pagetitle`

#### <a name="ext_summary"></a> экстендер summary

- `summary` - аннотация к странице

#### <a name="ext_user"></a> экстендер user

Экстендер необходимо загрузить вручную, указав его имя в параметре `&extender`.

Также должны быть заданы параметры:

- `usertype` - возможные значения: `manager`, `mgr`, `web`. Определяет из каких таблиц брать данные пользователей;
- `userFields` - названия колонок через запятую, в которых указан `id` пользователя, например `createdby`, `publishedby`.

Плейсхолдеры:

- `user.id.НазваниеКолонки` - ID пользователя
- `user.username.НазваниеКолонки` - логин пользователя
- `user.fullname.НазваниеКолонки` - полное имя пользователя
- `user.role.НазваниеКолонки` - ID роли пользователя
- `user.email.НазваниеКолонки` - e-mail
- `user.phone.НазваниеКолонки` - телефон
- `user.mobilephone.НазваниеКолонки` - мобильный телефон
- `user.blocked.НазваниеКолонки` - статус блокировки
- `user.blockeduntil.НазваниеКолонки` - до какого UNIX-времени пользователь будет заблокирован
- `user.blockedafter.НазваниеКолонки` - после какого UNIX-времени пользователь будет заблокирован
- `user.logincount.НазваниеКолонки` - общее число авторизаций
- `user.lastlogin.НазваниеКолонки` - UNIX-время последней авторизации
- `user.thislogin.НазваниеКолонки` - UNIX-время текущей авторизации
- `user.failedlogincount.НазваниеКолонки` - число неудачных попыток авторизоваться
- `user.lastlogin.НазваниеКолонки` - UNIX-время последней авторизации
- `user.dob.НазваниеКолонки` - дата рождения
- `user.gender.НазваниеКолонки` - пол
- `user.country.НазваниеКолонки` - страна
- `user.state.НазваниеКолонки` - регион
- `user.zip.НазваниеКолонки` - почтовый индекс
- `user.fax.НазваниеКолонки` - факс
- `user.photo.НазваниеКолонки` - фотография
- `user.comment.НазваниеКолонки` - коммментарий

#### контроллер site_content

- `title` - название документа для списков из `menutitle`, если `menutitle` пуст, то используется `pagetitle`.
- `iteration`, `ЗначениеПараметраsysKey.full_iteration` - порядковый номер элемента в списке; порядковый номер в списке с учетом пагинации.

_Примечание:_ для контроллера `site_content` и для контроллера `shopkeeper` плейсхолдер `iteration` выглядит как указано выше - `iteration` без префикса, а для контроллера `onetable` - как `ЗначениеПараметраsysKey.iteration` с префиксом. Префикс `ЗначениеПараметраsysKey` по умолчанию равен `dl`, то есть для `onetable` этот плейсхолдер по умолчанию - `[+dl.iteration+]`.

- `url` - ссылка на документ
- `date` - дата публикации документа сформированая по правилам указаным в параметре dateFormat (по умолчанию %d.%b.%y %H:%M). Помимо этого учитывается server_offset_time в настройках движка.
- `ЗначениеПараметраsysKey.active` - флаг определяющий, что обрабатываемый документ совпадает и документ на котором был вызван сниппет это одно и тоже (1 - если правда, 0 если нет)
- `ЗначениеПараметраsysKey.class` - классы которые могут быть автоматически присвоены документу (first, last, current, odd, even)
- `ЗначениеПараметраsysKey.wrap` - HTML код списка подготовленный для вывода пользователю (используется только для шаблона ownerTPL)

### <a name="plhld_global"></a> Глобальный плейсхолдер

?

## <a name="plhldparams"></a> Параметры для установки плейсхолдеров

| параметр                 | описание                            | по умолчанию |
| ------------------------ | ----------------------------------- | ------------ |
| [sysKey](#params_syskey) | Префикс для системных плейсхолдеров | dl           |
| [id](#params_id)         | Префикс для локальных плейсхолдеров |              |

### <a name="params_syskey"></a> sysKey

Префикс для системных плейсхолдеров.

_Значения:_ любая строка. На выходе получается плейсхолдер с именем `sysKey.placeholder`, где `sysKey` это значение данного параметра.

_По умолчанию:_ `dl`

### <a name="params_id"></a> id

Префикс для локальных плейсхолдеров.

_Значения:_ любая строка. Если `id` указано, то на выходе получается `id.placeholder`. Где `id` это и есть переданое значение. В случае если `id` не задано, то перед именем плейсхолдера точка не ставится.

_По умолчанию:_ нет значения.

## <a name="tplparams"></a> Параметры вывода в шаблоны

| параметр                              | описание                          | по умолчанию   |
| ------------------------------------- | --------------------------------- | -------------- |
| [ownerTPL](#param_ownertpl)           | Шаблон-обёртка для списка         |                |
| [tpl](#param_tpl)                     | Основной                          |                |
| [tplId1, tplId2, ...](#param_tplidn)  | По номеру итерации                | значение `tpl` |
| [tplOdd, tplEven](#param_tplodd)      | Для чётного/нечётного             | значение `tpl` |
| [tplFirst](#param_tplfirst)           | Первый в списке                   | значение `tpl` |
| [tplLast](#param_tpllast)             | Последний в списке                | значение `tpl` |
| [tplСurrent](#param_tplcurrent)       | Текущий                           | значение `tpl` |
| [noneTPL](#param_nonetpl)             | Нет результата                    |                |
| [noneWrapOuter](#param_nonewrapouter) | Оборачивать отсутствие результата | 1              |

### <a name="param_ownertpl"></a> ownerTPL

Шаблон в который оборачивается список результатов. Если подходящих результатов не обнаружено, то по умолчанию результат с шаблоном `noneTPL` тоже оборачивается в этот шаблон. За подробностями обращайтесь к описанию параметра `noneWrapOuter`.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ нет значения.

_Пример:_ `&ownerTPL='@CODE:<ul class="pages-list">[+dl.wrap+]</ul>'`

### <a name="param_tpl"></a> tpl

Основной шаблон.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в `DocLister`. Значение параметра может быть изменено из prepare-сниппета c помощью свойства `$_DocLister->renderTPL`.

_По умолчанию:_ определяется в контроллере.

_Пример:_ `&tpl='@CODE:<li><img src="[+tv.image+]" alt="[+e.pagetitle+]"><a href="[+url+]">[+title+] ([+id+])</a></li>'`

### <a name="param_tplidn"></a> tplId1, tplId2, ..., tplIdN

Шаблон для оформления документа под номером 1, 2 и т.д., где номер - это номер итерации начиная с 1.

_По умолчанию:_ значение `tpl`.

_Примечание:_ Обратите внимание, `Id` в названиях шаблонов не должно вводить вас в заблуждение, на самом деле номер - это не `Id` документа, а его номер по порядку в выводе (номер итерации).

### <a name="param_tplodd"></a> tplOdd, tplEven

Шаблон для оформления четного/нечетного документа.

_По умолчанию:_ значение `tpl`.

### <a name="param_tplfirst"></a> tplFirst

Шаблон для оформления первого документа в списке. Синоним параметра `tplId1`, но имеет больший приоритет.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в `DocLister`.

_По умолчанию:_ значение `tpl`.

### <a name="param_tpllast"></a> tplLast

Шаблон для оформления последнего документа в списке.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в `DocLister`.

_По умолчанию:_ значение `tpl`.

### <a name="param_tplcurrent"></a> tplСurrent

Шаблон для оформления текущего документа в списке документов.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в `DocLister`.

_По умолчанию:_ значение `tpl`.

### <a name="param_nonetpl"></a> noneTPL

Шаблон с уведомлением о том, что по заданным критериям ничего не обнаружено.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в `DocLister`.

_По умолчанию:_ нет значения.

### <a name="param_nonewrapouter"></a> noneWrapOuter

Оборачивать ли ответ `noneTPL` в шаблон `ownerTPL`. Параметр актуален только в том случае, если нет документов для построения списка и задан `ownerTPL`.

_Значения:_ `1` или `0`.

_По умолчанию:_ `1`.

## <a name="paginate"></a> Разбивка по страницам (пагинация)

| параметр                                        | описание                                         | по умолчанию |
| ----------------------------------------------- | ------------------------------------------------ | ------------ |
| [paginate](#param_paginate)                     | Вывод данных со страницами                       |              |
| [TplFirstP](#param_tplfirstp)                   | Шаблон ссылки `первая страница`                  | см. описание |
| [TplLastP](#param_tpllastp)                     | Шаблон ссылки `последняя страница`               | см. описание |
| [TplNextP](#param_tplnextp)                     | Шаблон ссылки `следующая страница`               | см. описание |
| [TplPrevP](#param_tplprevp)                     | Шаблон ссылки `предыдущая страница`              | см. описание |
| [TplPage](#param_tplpage)                       | Шаблон номера страницы                           | см. описание |
| [TplCurrentPage](#param_tplcurrentpage)         | Шаблон текущей страницы                          | см. описание |
| [TplWrapPaginate](#param_tplwarppaginate)       | Шаблон обёртки страниц                           | см. описание |
| [pageLimit](#param_pagelimit)                   | Число страниц в списке страниц                   | 1            |
| [pageAdjacents](#param_pageadjacents)           | Число страниц слева/справа от текущей            | 4            |
| [PaginateClass](#param_paginateclass)           | Класс контейнера страниц                         | paginate     |
| [PrevNextAlwaysShow](#param_prevnextalwaysshow) | Показывать следующая/предыдущая                  | 0            |
| [TplFirstI](#param_tplfirsti)                   | Шаблон _неактивной_ ссылки `первая страница`     | см. описание |
| [TplLastI](#param_tpllasti)                     | Шаблон _неактивной_ ссылки `последняя страница`  | см. описание |
| [TplNextI](#param_tplnexti)                     | Шаблон _неактивной_ ссылки `следующая страница`  | см. описание |
| [TplPrevI](#param_tplprevi)                     | Шаблон _неактивной_ ссылки `предыдущая страница` | см. описание |
| [TplDotsPage](#param_tpldotspage)               | Шаблон прострела                                 | ...          |
| [noRedirect](#param_noredirect)                 | Запрет переадресации                             | 0            |
| [paginationMeta](#param_paginationmeta)         | Вывод meta в head                                | 0            |

### <a name="param_paginate"></a> paginate

Вывод данных со страницами. Смотрите плейсхолдеры устанавливаемые экстендером `paginate`.

_Значения:_

- `offset` - пагинация в стиле Ditto;
- `pages` - пагинация с прострелами.

_По умолчанию:_ нет значения.

### <a name="param_tplfirstp"></a> TplFirstP

Шаблон для вставки ссылки `первая страница`.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в `DocLister`.

_По умолчанию:_ `@CODE:<li><a href="[+link+]">&laquo;&laquo;</a></li>`

### <a name="param_tpllastp"></a> TplLastP

Шаблон для вставки ссылки "последняя страница".

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:<li><a href="[+link+]">&raquo;&raquo;</a></li>`

### <a name="param_tplnextp"></a> TplNextP

Шаблон для вставки ссылки "следующая страница".

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:<li><a href="[+link+]">&raquo;</a></li>`

Языковые плейсхолдеры из движка `@CODE:<a href="[+link+]">[%paginate.next%] ></a>`

Встроенные языковые плейсхолдеры `@CODE:<a href="[+link+]">' . $this->DocLister->getMsg('paginate.next', 'Next') . ' ></a>`

### <a name="param_tplprevp"></a> TplPrevP

Шаблон для вставки ссылки "предыдущая страница".

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:<li><a href="[+link+]">&laquo;</a></li>`

Языковые плейсхолдеры из движка `@CODE:<a href="[+link+]">[%paginate.prev%] ></a>`

Встроенные языковые плейсхолдеры `@CODE:<a href="[+link+]">< ' . $this->DocLister->getMsg('paginate.prev', 'Prev') . '</a>`

### <a name="param_tplpage"></a> TplPage

Шаблон для вставки номера страницы в пагинатор.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:<a href="[+link+]">[+num+]</a>`

### <a name="param_tplcurrentpage"></a> TplCurrentPage

Шаблон оформления текущей страницы в пагинаторе

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:<li class="active"><a href="[+link+]">[+num+]</a></li>`

### <a name="param_tplwrappaginate"></a> TplWrapPaginate

Шаблон контейнера для обертки страниц пагинации.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:<div class="[+class+]">[+wrap+]</div>`

### <a name="param_pagelimit"></a> pageLimit

Число страниц отображаемое в пагинаторе.

_Значения:_ целое число больше ноля.

_По умолчанию:_ `1`.

### <a name="param_pageadjacents"></a> pageAdjacents

Максимальное число страниц слева и справа относительно текущей страницы.

_Значения:_ целое число больше ноля.

_По умолчанию:_ `4`.

### <a name="param_paginateclass"></a> PaginateClass

Класс для контейнера в который будут вложены страницы пагинации.

_Значения:_ любая строка сформированная по правилам для подстановки в HTML аттрибута class.

_По умолчанию:_ `paginate`.

### <a name="param_prevnextalwaysshow"></a> PrevNextAlwaysShow

Всегда показывать "следующая страница" и "предыдущая страница".

_Значения:_ `1` или `0`.

_По умолчанию:_ `0`.

### <a name="param_tplfirsti"></a> TplFirstI

Шаблон для вставки _неактивной_ ссылки "первая страница", используется совместно с `PrevNextAlwaysShow`.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:<li class="disabled"><a href="[+link+]">&laquo;&laquo;</a></li>`.

### <a name="param_tpllasti"></a> TplLastI

Шаблон для вставки _неактивной_ ссылки "последняя страница", используется совместно с `PrevNextAlwaysShow`.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:<li class="disabled"><a href="[+link+]">&raquo;&raquo;</a></li>`.

### <a name="param_tplnexti"></a> TplNextI

Шаблон для вставки _неактивной_ ссылки "следующая страница", используется совместно с `PrevNextAlwaysShow`.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:[%paginate.next%] >`

_Рекомендуется:_ `@CODE:<li class="disabled"><a href="[+link+]">&raquo;</a></li>`

### <a name="param_tplprevi"></a> TplPrevI

Шаблон для вставки _неактивной_ ссылки "предыдущая страница", используется совместно с `PrevNextAlwaysShow`.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:< [%paginate.prev%]`

_Рекомендуется:_ `@CODE:<li class="disabled"><a href="[+link+]">&laquo;</a></li>`

### <a name="param_tpldotspage"></a> TplDotsPage

Шаблон прострела.

_Значения:_ имя шаблона указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ `@CODE:...`

### <a name="param_noredirect"></a> noRedirect

Запрещает переадресацию при запросе несуществующей страницы.

_Значения:_ `0` или `1`.

_По умолчанию:_ `0`.

### <a name="param_paginationmeta"></a> paginationMeta

Вывод мета-тегов `link rel="next"` и `link rel="prev"` в `head` сайта.

_Пример:_ `<link rel="prev" href="[+prev+]"><link rel="next" href="[+next+]'">`

_Значения:_ `0` или `1`.

_По умолчанию:_ `0`.

## <a name="plhldres"></a> Вывод в плейсхолдеры

| параметр                                                      | описание                                     | по умолчанию |
| ------------------------------------------------------------- | -------------------------------------------- | ------------ |
| [contentPlaceholder](#param_contentplaceholder)               | Значения документов в отдельные плейсхолдеры | 0            |
| [paginationMetaPlaceholder](#param_paginationmetaplaceholder) | Куда добавить meta                           | 0            |

### <a name="param_contentplaceholder"></a> contentPlaceholder

Установка значений документов в персонализованные плейсхолдеры.

_Значения:_ `0` или `1`.

Если значение параметра равно `1`, то `DocLister` создает плейсхолдеры вида `id.item[x]`, где `x` это порядковый номер документа в списке, а `id` это значение параметра `id` (см. описание параметра `id`).

_По умолчанию:_ `0`

### <a name="param_paginationmetaplaceholder"></a> paginationMetaPlaceholder

_Значения:_ `0` или `1`. Если значение параметра равно `1`, то результат выполнения параметра `paginationMeta` попадает не в шапку, а в глобальный плейсхолдер `paginationMeta`.

_По умолчанию:_ `0`

## <a name="tplsep"></a> Разделитель между шаблонами

| параметр                                  | описание                   | по умолчанию |
| ----------------------------------------- | -------------------------- | ------------ |
| [outputSeparator](#param_outputseparator) | Разделитель значений в tpl |              |

### <a name="param_outputseparator"></a> outputSeparator

Установка разделителя, который будет выводиться между значениями, выводимыми в шаблоне `tpl`.

_Значения:_ любая строка.

_По умолчанию:_ нет значения.

_Пример:_ Используется в поле "Возможные значения" TV-параметра

```php
@EVAL
$snippet_name = 'DocLister';
$arrparams = array(
	'id' => 'brands_select',
	'parents' => '1171',
	'depth' => '0',
	'tvPrefix' => '',
	'tvList' => '',
	'tpl'=>'brands_select_tpl',
	'orderBy'=>'pagetitle ASC',
	'total' => 'all',
	'noneWrapOuter' => '0',
	'dateFormat'=>'%d.%m.%Y',
	'outputSeparator'=>'||'
);
return $modx->runSnippet($snippet_name, $arrparams);
```

## <a name="apimode"></a> API-режим

| параметр                        | описание              | по умолчанию |
| ------------------------------- | --------------------- | ------------ |
| [api](#param_api)               | Выдача в формате json | 0            |
| [JSONformat](#param_jsonformat) | Как формировать json  | old          |

### <a name="param_api"></a> api

Используется для формирования выдачи в формате JSON.

_Значения:_ `0`, `1` или список полей выбираемых документов.

_По умолчанию:_ `0`.

### <a name="param_jsonformat"></a> JSONformat

По какому принципу формировать JSON-ответ.

_Значения:_ `old` или `new`.

В формате `old` ответ выглядит в виде обычного массива. В формате `new` ответ заворачивается в `rows` секцию + добавляется примесь `total` в которой указано общее число учавствующих в выборке.

_По умолчанию:_ `old`.
