# Параметры выборки

- [Основные параметры выборки](#params)
- [Выборка для произвольных таблиц](#onetable)
- [Выборка с TV-параметрами](#tv)
- [Сортировка](#sort)
- [Сортировка по TV-параметрам](#tv-sort)
- [Фильтрация](#filter)
- [Выборка по тегам](#tags)
- [Дополнительные данные](#other)

## <a name="params"></a> Основные параметры

| параметр                             | описание                | умолч.         |
| ------------------------------------ | ----------------------- | -------------- |
| [controller](#params_controller)     | Откуда получать данные  | site_content   |
| [idType](#params_idtype)             | Тип выборки             | parents        |
| [parents](#params_parents)           | Список родителей        | id страницы    |
| [documents](#params_documents)       | Список документов       |                |
| [ignoreEmpty](#params_ignoreempty)   | Игнорировать пустые     | 0              |
| [display](#params_display)           | Максимально получить    | 0              |
| [queryLimit](#params_querylimit)     | Максимально получить    | 0              |
| [depth](#params_depth)               | Глубина выборки         | 0              |
| [offset](#params_offset)             | Пропустить от начала    | 0              |
| [start](#params_start)               | Сдвиг всегда            | 0              |
| [total](#params_total)               | Максимально на странице | 0              |
| [addWhereList](#params_addwherelist) | Дополнительный фильтр   |                |
| [showParent](#params_showparent)     | Показывать родителей    | 0              |
| [selectFields](#params_selectfields) | Запрашивать поля        |                |
| [groupBy](#params_groupby)           | Группировка результатов | из контроллера |

### <a name="params_controller"></a> controller

Задает класс для выборки данных. Базовые классы расположены в папке `DocLister/core/controller/`:

- `site_content` - для работы с документами MODX;
- `shopkeeper` - для работы с каталогом `Shopkeeper`;
- `onetable` - для работы с произвольными таблицами;
- `site_content_tags` - вывод документов MODX с фильтрацией по тегам в связке с плагином `TagSaver`.

_По умолчанию:_ `site_content`

### <a name="params_idtype"></a> idType

Тип выборки документов.

_Значения:_ `parents, documents`.

Список документов подставляемых в запрос будет выбран из параметра, имя которого совпадает со значением данного параметра.

Во избежание недоразумений рекомендуется всегда явно определять этот параметр. Особенно актуально, когда одновременно используются параметры `parents` и `documents`.

_По умолчанию:_ `parents`

### <a name="params_parents"></a> parents

Выборка документов на основании списка родительских документов.

_Значения:_ `id` родительских документов, разделенные запятой.

_По умолчанию:_ `id` страницы, на которой вызывается сниппет.

### <a name="params_documents"></a> documents

Выборка произвольных документов.

Если используется параметр `parents__`, то документы перечисленные в этом параметре будут просто подмешаны в результат и подвержены последующим правилам выборки (фильтрация, сортировка).

_Значения:_ `id` документов, разделенные запятой.

_По умолчанию:_ нет значения

### <a name="params_ignoreempty"></a> ignoreEmpty

Позволяет сделать выборку всех записей из таблицы, если параметр `documents` не задан. Параметр `idType` в этом случае должен быть `documents`.

_Значения:_ `1` или `0`.

_По умолчанию:_ `0`.

### <a name="params_display"></a> display

Максимальное число документов при выборке.

_Значения:_ целое число, которое больше или равно `0`.

Может быть переопределено значением параметра `queryLimit`.

_По умолчанию:_ `0`.

### <a name="params_querylimit"></a> queryLimit

Максимальное число документов при выборке.

_Значения:_ целое число, которое больше или равно `0`.

_По умолчанию:_ `0`.

### <a name="params_depth"></a> depth

Глубина выборки с использованием параметра parents.

_Значения:_ целое число, которое больше или равно `0`.

_По умолчанию:_ `0`.

### <a name="params_offset"></a> offset

Число пропускаемых документов с начала списка. Переопределяется при использовании пагинации. Если же требуется всегда пропускать `N` документов, то необходимо использовать параметр `start`.

_Значения:_ целое число, которое больше или равно `0`.

_По умолчанию:_ `0`.

### <a name="params_start"></a> start

Число документов пропускаемых с начала выборки. Складывается со значением `offset` автоматически устанавливаемым при пагинации.

_Значения:_ целое число, которое больше или равно `0`.

_По умолчанию:_ `0`.

### <a name="params_total"></a> total

Максимальное число документов отображаемое на одной странице в выборке.

_Значения:_ целое число, которое больше или равно `0`.

_По умолчанию:_ `0`.

### <a name="params_addwherelist"></a> addWhereList

Дополнительные условия выборки документов. Любая строка удовлетворяющая требованиями строки для подстановки в `WHERE` блок SQL запроса.

_По умолчанию:_ нет значения.

### <a name="params_showparent"></a> showParent

Исключение документов из которых делалась выборка с использованием параметра `parents`.

_Значения:_

- `0` - принудительное игнорирование родителей в выборке,
- `1` - принудительное добавление родителя в выборку,
- `-1` - игнорируются только родители, указанные в параметре `parents`.

_По умолчанию:_ `0`.

### <a name="params_selectfields"></a> selectFields

Имена полей, включаемых в выборку.

_По умолчанию:_ нет значения.

### <a name="params_groupby"></a> groupBy

Группировка результатов по какому-нибудь полю.

_По умолчанию:_ определяется в контроллере

## <a name="onetable"></a> Выборка для произвольных таблиц (контроллер `onetable`)

| параметр                           | описание                         | умолч.       |
| ---------------------------------- | -------------------------------- | ------------ |
| [table](#params_table)             | Таблица для выборки              | site_content |
| [idField](#params_idfield)         | Имя поля `PrimaryKey`            | id           |
| [parentField](#params_parentfield) | Имя поля родительских документов | parent       |

### <a name="params_table"></a> table

Имя таблицы по которой будет производиться выборка. Если в таблице `PrimaryKey` отличается от `id`, то необходимо дополнительно задать имя этого поля в параметре `idField`.

_Значения:_ любое имя таблицы без префикса таблиц MODX.

_По умолчанию:_ `site_content`

### <a name="params_idfield"></a> idField

Имя поля `PrimaryKey`. Документы, указанные через параметр `documents`, будут выбираться по этому полю.

_Значения:_ любое имя поля доступного в таблице, указанной через параметр `table`.

_По умолчанию:_ `id`

### <a name="params_parentfield"></a> parentField

Имя поля в котором хранятся значения `idField` родительских документов. Используется при выборке документов из параметра `parents`.

_Значения:_ любое имя поля доступного в таблице, указанной через параметр `table`.

_По умолчанию:_ `parent`.

## <a name="tv"></a> Выборка с TV-параметрами

| параметр                     | описание                  | умолч. |
| ---------------------------- | ------------------------- | ------ |
| [tvList](#params_tvlist)     | Список TV                 |        |
| [tvPrefix](#params_tvprefix) | Префикс для плейсхолдеров | tv     |
| [renderTV](#params_rendertv) | Обработка TV              |        |

### <a name="params_tvlist"></a> tvList

Список TV-параметров, которые должны быть в выборке.

_Значения:_ имена TV-параметров, разделенные запятой.

_По умолчанию:_ нет значения.

### <a name="params_tvprefix"></a> tvPrefix

Префикс для плейсхолдеров создаваемых из имен TV-параметров.

_По умолчанию:_ `tv`

### <a name="params_rendertv"></a> renderTV

TV-параметры, значение которых необходимо подготовить к отображению в соответствии с установленными виджетами. TV-параметры которых нет в значении параметра `tvList` будут проигнорированы.

_Значения:_ `*` или список имен TV параметров, разделенный запятой.

_По умолчанию:_ нет значения.

## <a name="sort"></a> Сортировка

| параметр                     | описание                 | умолч.  |
| ---------------------------- | ------------------------ | ------- |
| [sortType](#params_sorttype) | Режим сортировки         | none    |
| [orderBy](#params_orderby)   | Единая строка сортировки | id DESC |
| [sortBy](#params_sortby)     | Критерий сортировки      |         |
| [sortDir](#params_sortdir)   | Направление сортировки   | DESC    |
| [order](#params_order)       | Направление сортировки   | DESC    |

### <a name="params_sorttype"></a> sortType

Значение sortType определяет режим сортировки. Если не задано, то производится сортировка по критериям, указанным в параметрах `orderBy` или `sortBy` и `sortDir`

_Значения:_

- `none` - автоматическая сортировка правилами MySQL (обычно по primary key);
- `doclist` - вывод документов в том порядке, в каком они переданы в сниппет через параметр `documents`;

_По умолчанию:_ `none`.

### <a name="params_orderby"></a> orderBy

Единая строка сортировки (как минимум совокупность параметров `sortBy` и `sortDir`, но имеет больший приоритет).

_Значения:_ любая строка удовлетворяющая правилам построения параметра `ORDER BY` в SQL запросе. При сортировке в контроллере `site_content` желательно использовать префикс `c.` для полей таблицы `site_content`. Имена TV-параметров указываются как есть.

Для сортировки в случайном порядке значение параметра `orderBy` будет `RAND()`.

_По умолчанию:_ `id DESC` (или определяется в контроллере)

### <a name="params_sortby"></a> sortBy

Критерий сортировки без направления сортировки.

_Значения:_ любая строка удовлетворяющая правилам построения параметра `ORDER BY` в SQL запросе. Имена TV-параметров указываются как есть.

_По умолчанию:_ нет значения. Значение по умолчание может быть жестко задано в контроллере.

### <a name="params_sortdir"></a> sortDir

Направление сортировки.

_Значения:_ `ASC`, `DESC`.

_По умолчанию:_ `DESC` (или определяется в контроллере).

### <a name="params_order"></a> order

Направление сортировки. Синоним параметра `sortDir`, но имеет меньший приоритет. Если установлены два параметра: `order` и `sortDir`, то будет использоваться значение параметра `sortDir`.

_Значения:_ `ASC`, `DESC`.

_По умолчанию:_ `DESC`.

### Приоритеты параметров сортировки

Чем выше в списке, тем больше приоритет:

- orderBy
- sortBy и sortDir
- order

## <a name="sort-tv"></a> Сортировка по TV-параметрам

| параметр                                       | описание                                      | умолч. |
| ---------------------------------------------- | --------------------------------------------- | ------ |
| [tvSortType](#params_tvsorttype)               | Приведение типов TV-параметров при сортировке |        |
| [tvSortWithDefault](#params_tvsortwithdefault) | Со значениями по умолчанию                    |        |

### <a name="params_tvsorttype"></a> tvSortType

Правила приведения типов TV-параметров при сортировке. При сортировке по TV-параметрами крайне рекомендуется указывать приведение типов.

Возможные значения (перечисляются через запятую в том порядке, в котором указаны имена TV в параметре `orderBy`):

- `DECIMAL` - числа с двумя знаками после запятой;
- `UNSIGNED` - беззнаковые целые числа;
- `SIGNED` - целые больше нуля;
- `BINARY` - бинарный режим;
- `DATETIME` - дата;
- `TVDATETIME` - приводит строку в дату согласно формату, который используется TV-параметром с типом ввода `Date` (доступно только из контроллеров на базе `site_content`).

### <a name="params_tvsortwithdefault"></a> tvSortWithDefault

В силу особенностей движка (TV-параметры значения которых совпадают со значениями по умолчанию не сохраняются в отдельную таблицу), сортировка записей может быть не корректа, если значение по умолчанию отличается от пустой стрки. Поэтому рекомендуется дополнительно указывать ТВ-параметры у которых принудительно указано значение по умолчанию.

## <a href="filter"></a> Фильтрация

| параметр                                    | описание                            | умолч. |
| ------------------------------------------- | ----------------------------------- | ------ |
| [showNoPublish](#params_shownopublish)      | Выводить неопубликованные/удалённые |        |
| [filters](#params_filters)                  | Фильтры                             |        |
| [filter_delimiter](#params_filterdelimiter) | Разделитель для `containsOne`       |        |

### <a name="params_shownopublish"></a> showNoPublish

Вывод удаленных или не опубликованных ресурсов (используется только в контроллерах на базе `site_content`)

_Значения:_ `0` или `1`

_По умолчанию:_ `0`

### <a name="params_filters"></a> filters

Правила для фильтрации документов.

_Значения:_ cтрока сформированая по правилам описанным в `DocLister::getFilters()`. Подробнее в разделе _Фильтры_.

_По умолчанию:_ нет значения.

_Пример строки:_ `OR(AND(filter:field:operator:value;filter2:field:operator:value);(...))`

### <a name="params_filterdelimiter"></a> filter_delimiter

Разделитель фильтров для режима `containsOne`.

_Значения:_ любая строка.

## <a href="tags"></a> Выборка по тегам

| параметр                     | описание              | умолч. |
| ---------------------------- | --------------------- | ------ |
| [tagsData](#params_tagsdata) | Строка источник тегов |        |

### <a name="params_tagsdata"></a> tagsData

Строка определяющая источник тегов.

Для автоматической подстановки тегов из `GET` переменной необходимо указать имя этой переменной, передав в этом параметре значение типа `get:tag`. В таком случае, теги должны подставляться в `$_GET['tag']`. В случае же если нужна статичная выборка, то можно `get` заменить на `static` и после двоеточия передать значение тега, например, `static:значение_тега`.

_Значения:_ cтрока с правилами разделеная двоеточием.

_По умолчанию:_ нет значения.

## <a name="other"></a> Дополнительные данные

| параметр                             | описание                           | умолч.         |
| ------------------------------------ | ---------------------------------- | -------------- |
| [urlScheme](#params_datesource)      | Схема генерации URL                |                |
| [dateSource](#params_datesource)     | Поле документа с датой             | ub_date        |
| [dateFormat](#params_dateformat)     | Правила форматирования даты        | %d.%b.%y %H:%M |
| [summary](#params_summary)           | Правила создания краткого описания |                |
| [introField](#params_introtext)      | Поле источника краткого описания   |                |
| [contentField](#params_contentfield) | Поле контента ресурса              |                |
| [e](#params_e)                       | Экранирование значений полей       |                |
| [jotcount](#params_jotcount)         | количество комментариев `JotX`     | 0              |

### <a name="params_urlscheme"></a> urlScheme

Схема генерации URL

_Значения:_ схемы доступные в MODX Evolution (относительные, `http`, `https`, `full`).

_По умолчанию:_ нет значения (= относительные ссылки)

### <a name="params_datesource"></a> dateSource

Поле документа в котором располагается дата.

Если вы используете отложенную публикацию для некоторых документов и указываете сортировку по полю `pub_date`. Так вот, c `DocLister` у вас никогда не получится ситуации, что документы опубликованные без отложенной публикации всегда будут в конце списка.

_Значения:_ название поля в таблице. Если в качестве значения была указана строка отличная от `createdon` и значение данного поля в базе равно `0`, то тогда все равно берется значение из `createdon`.

_По умолчанию:_ `pub_date`.

### <a name="params_dateformat"></a> dateFormat

Правила форматирования даты `format` для PHP функции `strftime`.

В качестве источника даты используется параметр `dateSource`. Помимо этого учитывается смещение даты на сервере (смотрите системный параметр `server_offset_time`). Таким образом, можно использовать персонализованную подстановку времени в зависимости от часового пояса пользователя.

_По умолчанию:_ `%d.%b.%y %H:%M`

### <a name="params_summary"></a> summary

Правила обработки текстов для формирования краткого описания.

Загружает экстендер `summary`. В контроллере `site_content` есть дополнительное правило для обрабатываемого текста: по умолчанию на обработку отправляется поле `content`. Но если поле `introtext` не пустое, то текст именно из этого поля будет передан в дополнение `summary`. Аналогичным образом себе ведет и контроллер `onetable`.

_Значения:_ cтрока сформированная по правилам экстендера `summary`, например `действие1:параметр1,действие2:параметр2А:параметр2Б,действие3`

_По умолчанию:_ нет значения.

### <a name="params_introtext"></a> introField

Имя поля для источника краткого описания текста из `contentField`. Используется только если загружен экстендер `summary`.

_По умолчанию:_ нет значения.

### <a name="params_contentfield"></a> contentField

Имя поля в котором хранится основной текст документа. Используется только если загружен экстендер `summary`

_По умолчанию:_ нет значения.

### <a name="params_e"></a> e

Экранирование значений полей. Имена полей доступны в шаблонах через плейсхолдеры с префиксом `e`: `[+e.pagetitle+]`, `[+e.longtitle+]`.

_Значения:_ `имена полей` через запятую.

_По умолчанию:_ нет значения.

### <a name="params_jotcount"></a> jotcount

Добавляет в выборку количество комментариев `JotX` с помощью экстендера `jotcount`.

_Значения:_ `1` или `0`

_По умолчанию:_ `0`
