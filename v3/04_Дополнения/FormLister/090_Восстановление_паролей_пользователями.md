# Восстановление паролей пользователями

Контроллер `Reminder` позволяет web-пользователям восстанавливать забытые пароли. Расширяет контроллер `Form`.

Восстановление паролей происходит по следующей схеме:

- пользователь вводит в форме свой идентификатор (им может быть имя пользователя или `email`);
- пользователь получает письмо, в котором содержится ссылка для восстановления;
- при переходе по ссылке пользователь получает возможность ввести новый пароль либо пароль будет сгенерирован автоматически;
- пользователю отправляется письмо с новым паролем и показыается сообщение (в сообщении можно также вывести новый пароль).

Параметр `to` перезаписывается значением `email` пользователя. Обязательно должен быть задан параметр `resetTo`.

## Параметры

| параметр                                  | описание                                                                  | умолч.                                 |
| ----------------------------------------- | ------------------------------------------------------------------------- | -------------------------------------- |
| [model](#param_model)                     | имя класса                                                                | `\modUsers`                            |
| [modelPath](#param_modelpath)             | путь к файлу класса                                                       | `assets/lib/MODxAPI/modUsers.php`      |
| [hashField](#param_hashfield)             | поле для хранения хеша                                                    | `hash`                                 |
| [userField](#param_userfield)             | поле идентификатора пользователя                                          | `email`                                |
| [uidField](#param_uidfield)               | поле числового идентификатора пользователя                                | `id`                                   |
| [uidName](#param_uidname)                 | имя get-параметра с id пользователя                                       | см. описание                           |
| [exitTo](#param_exitto)                   | перенаправить уже авторизованного                                         |                                        |
| [resetTo](#param_resetto)                 | страница с восстановлением пароля                                         | текущая страница                       |
| [redirectTo](#param_redirectto)           | перенаправить после восстановления пароля                                 |                                        |
| [skipTpl](#param_skiptpl)                 | шаблон сообщения для авторизованного                                      | `[+reminder.default_skipTpl+]`         |
| [formTpl](#param_formtpl)                 | шаблон формы ввода идентификатора польз.                                  |                                        |
| [resetTpl](#param_resettpl)               | шаблон формы ввода нового пароля                                          |                                        |
| [successTpl](#param_successtpl)           | шаблон сообщения об успешной отправке письма со ссылкой на восстановление | `[+reminder.default_successTpl+]`      |
| [resetSuccessTpl](#param_resetsuccesstpl) | шаблон сообщения об успешном восстановлении пароля                        | `[+reminder.default_resetSuccessTpl+]` |
| [reportTpl](#param_reporttpl)             | шаблон письма со ссылкой на восстановление                                | `[+reminder.default_reportTpl+]`       |
| [resetReportTpl](#param_resetreporttpl)   | шаблон письма об успешном восстановлени пароля                            |                                        |
| [rules](#param_rules)                     | правила валидации формы идентификации                                     |                                        |
| [resetRules](#param_resetrules)           | правила валидации формы ввода нового пароля                               |                                        |
| [passwordLength](#param_passwordlength)   | длина пароля                                                              | `6`                                    |

### <a name="param_model"></a> model

Класс для работы с пользователями.

_Значения:_ имя класса. Для Evo 3.x следует использовать модель `Pathologic\EvolutionCMS\MODxAPI\modUsers` из пакета `pathologic/modxapi`.

_По умолчанию:_ `\modUsers`

### <a name="param_modelpath"></a> modelPath

Путь к файлу класса для работы с пользователями.

_Значения:_ относительный путь к файлу.

_По умолчанию:_ `assets/lib/MODxAPI/modUsers.php`

### <a name="param_hasfield"></a> hashField

Имя поля для хранения хэша данных пользователя.

_По умолчанию:_ `hash`.

### <a name="param_userfield"></a> userField

Имя поля для хранения уникального идентификатора пользователя (имя пользователя или email).

_По умолчанию:_ `email`.

### <a name="param_uidfield"></a> uidField

Имя поля, которое содержит числовой идентификатор пользователя (Primary Key в таблице БД).

_По умолчанию:_ `id`.

### <a name="param_uidname"></a> uidName

Имя GET-параметра в ссылке для восстановления пароля, который содержит id пользователя.

_По умолчанию:_ значение параметра uidField.

### <a name="param_exitto"></a> exitTo

Перенаправляет авторизованного пользователя на указанную страницу.

_Значения:_ id целевой страницы.

_По умолчанию:_ нет значения.

### <a name="param_resetto"></a> resetTo

Страница, на которую будет указывать ссылка для восстановления паролей.

_Значения:_ id целевой страницы.

_По умолчанию:_ id документа, в котором вызван контроллер.

### <a name="param_redirectto"></a> redirectTo

Перенаправляет на указанную страницу после успешного восстановления пароля.

_Значения:_ id целевой страницы.

_По умолчанию:_ нет значения.

### <a name="param_skiptpl"></a> skipTpl

Шаблон сообщения для авторизованного пользователя.

_Значения:_ имя шаблона, указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ запись из лексикона `Reminder` с ключом `[+reminder.default_skipTpl+]`.

### <a name="param_formtpl"></a> formTpl

Шаблон формы для ввода идентификатора пользователя.

_Значения:_ имя шаблона, указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ нет значения.

### <a name="param_resettpl"></a> resetTpl

Шаблон формы для ввода нового пароля. Если параметр не задан, то пароль будет сгенерирован автоматически.

Поля для ввода паролей должны называться `password` и `repeatPassword`. В форме должны также присутствовать скрытые поля с именами из параметров `uidField` и `hashField`. Значение для поля `hashField` задается через плейсхолдер `[+user.hash+]`, а для поля `uidField` - `[+user.id+]`.

_Значения:_ имя шаблона, указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ нет значения.

### <a name="param_successtpl"></a> successTpl

Шаблон сообщения об успешной отправке письма со ссылкой для восстановления пароля. В шаблоне можно выводить плейсхолдеры с данными пользователя (`username`, `email` и т.д.).

_Значения:_ имя шаблона, указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ запись из лексикона `Reminder` с ключом `[+reminder.default_successTpl+]`.

### <a name="param_resetsuccesstpl"></a> resetSuccessTpl

Шаблон сообщения об успешном восстановлении пароля. В шаблоне можно выводить плейсхолдеры с данными пользователя (`username`, `email` и т.д.), а также новый пароль (`newpassword`).

_Значения:_ имя шаблона, указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ запись из лексикона `Reminder` с ключом `[+reminder.default_resetSuccessTpl+]`.

### <a name="param_reporttpl"></a> reportTpl

Шаблон письма со ссылкой для восстановления пароля. В шаблоне можно выводить плейсхолдеры с данными пользователя (`username`, `email` и т.д.), а также новый пароль (`newpassword`). Ссылка для восстановлени пароля в письме задается через плейсхолдер `[+reset.url+]`

_Значения:_ имя шаблона, указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ запись из лексикона `Reminder` с ключом `[+reminder.default_reportTpl+]`.

### <a name="param_resetreporttpl"></a> resetReportTpl

Шаблон письма об успешном восстановлении пароля. В шаблоне можно выводить плейсхолдеры с данными пользователя (`username`, `email` и т.д.), а также новый пароль (`newpassword`). Если не задан, то письмо пользователю отправляться не будет.

_Значения:_ имя шаблона, указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ нет значения.

### <a name="param_rules"></a> rules

Правила валидации для формы идентификации пользователя.

_Значения:_ см. раздел "Валидация данных".

_По умолчанию:_ нет значения.

### <a name="param_resetrules"></a> resetRules

Правила валидации для формы установки нового пароля. Если заданы правила валидации для полей `password` и `repeatPassword`, то при наличии для поля `repeatPassword` правила `equals`, оно будет автоматически скорректировано для проверки равенства значений полей `password` и `repeatPassword`:

```
"repeatPassword":{
    "required": "Введите пароль еще раз",
    "equals":{
        "params" : "Этот ключ в описании правила можно не задавать, он будет сформирован контроллером автоматически",
        "message":"Пароли не совпадают"
    }
}
```

_Значения:_ см. раздел "Валидация данных".

_По умолчанию:_ нет значения.

### <a name="param_passwordlength"></a> passwordLength

Длина пароля (если создается автоматически).

_Значения:_ число символов больше 6.

_По умолчанию:_ `6`.
