# Редактирование профиля пользователя

Контроллер `Profile` позволяет авторизованным пользователям редактировать свои профили, в том числе менять пароль.

При изменении профиля следует проверять уникальность `email`. В контроллере предусмотрено соответствующее правило:

```
&rules=`{
    "email": {
        "required": "Введите email",
        "email": "Неверный email",
        "custom": {
            "function": "\\FormLister\\Profile::uniqueEmail",
            "message": "Этот email уже использует другой пользователь"
        }
    }
}`
```

Аналогично с полем username:

```
&rules=`{
    "username": {
        "required": "Введите имя пользователя",
        "alphaNumeric": "Только буквы и цифры",
        "custom": {
            "function": "\\FormLister\\Profile::uniqueUsername",
            "message": "Имя уже занято"
        }
    }
}`
```

Если поле с паролем пустое, то пароль остается прежний. Новый пароль сохраняется в поле `user.password`.

Активация пользователя сбрасывается, если изменяется поле, заданное в параметре `verificationField`. При этом, если включена проверка активации (параметр `checkActivation`), пользователь должен авторизоваться заново.

## Параметры

| параметр                                        | описание                                        | умолч.                            |
| ----------------------------------------------- | ----------------------------------------------- | --------------------------------- |
| [model](#param_model)                           | имя класса                                      | `\modUsers`                       |
| [modelPath](#param_modelpath)                   | путь к файлу класса                             | `assets/lib/MODxAPI/modUsers.php` |
| [allowedFields](#param_allowedfields)           | разрешенные поля                                |                                   |
| [forbiddenFields](#param_forbiddenfields)       | запрещённые поля                                |                                   |
| [verificationField](#param_verificationfield)   | поле проверки                                   | `email`                           |
| [checkActivation](#param_checkactivation)       | проверять активацию                             | `0`                               |
| [preparePostProcess](#param_preparepostprocess) | доп. обработка после сохранения                 |                                   |
| [redirectTo](#param_redirectto)                 | перенаправить после регистрации                 |                                   |
| [exitTo](#param_exitto)                         | перенаправить уже авторизованного               |                                   |
| [skipTpl](#param_skiptpl)                       | шаблон сообщения для неавторизованного          | `[+profile.default_skipTpl+]`     |
| [successTpl](#param_successtpl)                 | шаблон сообщения об успешной обновлении профиля |                                   |
| [dateFormat](#param_dateformat)                 | формат даты поля dob                            |                                   |

### <a name="param_model"></a> model

Класс для работы с пользователями.

_Значения:_ имя класса. Для Evo 3.x следует использовать модель `Pathologic\EvolutionCMS\MODxAPI\modUsers` из пакета `pathologic/modxapi`.

_По умолчанию:_ `\modUsers`

### <a name="param_modelpath"></a> modelPath

Путь к файлу класса для работы с пользователями.

_Значения:_ относительный путь к файлу.

_По умолчанию:_ `assets/lib/MODxAPI/modUsers.php`

### <a name="param_allowedfields"></a> allowedFields

Разрешенные для обработки поля. Поля, не указанные в списке, игнорируются. Если пользователь меняет пароль, то в разрешенные поля добавляется поле password. Если у пользователей совпадают поля `email` и `username`, то при изменении `email` будет изменено и поле `username`, если значение этого поля не задано. В этом случае поле `username` будет добавлено в список разрешенных.

Если не задано, то разрешены все поля.

_Значения:_ имена полей формы, разделенные запятой.

_По умолчанию:_ нет значения.

### <a name="param_forbiddenfields"></a> forbiddenFields

Запрещенные для обработки поля. Поля, указанные в списке, игнорируются. Поля `password` и `username` исключаются из списка по аналогии с `allowedFields`.

_Значения:_ имена полей формы, разделенные запятой.

_По умолчанию:_ нет значения.

### <a name="param_verificationfield"></a> verificationField

Поле, изменение которого приводит к сбросу активации.

_Значения:_ имя поля.

_По умолчанию:_ `email`.

### <a name="param_checkactivation"></a> checkActivation

Если включено, то при изменении поля, указанного в параметре `verificationField`, потребуется повторная авторизация.

_Значения:_ `0`, `1`.

_По умолчанию:_ `0`.

### <a name="param_preparepostprocess"></a> preparePostProcess

Позволяет выполнить обработку данных после сохранения.

_Значения:_ имена сниппетов, анонимные функции, статические методы загруженных классов.

_По умолчанию:_ нет значения.

### <a name="param_redirectto"></a> redirectTo

Перенаправляет пользователя на указанную страницу после сохранения профиля.

_Значения:_ id целевой страницы.

_По умолчанию:_ нет значения.

### <a name="param_exitto"></a> exitTo

Перенаправляет неавторизованного пользователя на указанную страницу.

_Значения:_ id целевой страницы или массив.

_По умолчанию:_ нет значения.

### <a name="param_skiptpl"></a> skipTpl

Шаблон сообщения для неавторизованного пользователя.

_Значения:_ имя шаблона, указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ запись из лексикона `Profile` с ключом `[+profile.default_skipTpl+]`

### <a name="param_successtpl"></a> successTpl

Шаблон сообщения об успешном обновлении профиля. Если не задан, то генерируется сообщение об успешном сохранении формы.

_Значения:_ имя шаблона, указанное по правилам задания шаблонов в DocLister.

_По умолчанию:_ нет значения.

### <a name="param_dateformat"></a> dateFormat

Формат даты для поля dob.

_Значения:_ формат даты по правилам функции date (например, `d.m.Y`).
